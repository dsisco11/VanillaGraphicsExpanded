Issues:
  ☐ Mod settings not live reloading properly (e.g. changes to Lumon shader settings dont always take effect).
  ☐ Need better material override system, consider allowing material definitions to specify a "base material" to inherit from.
  ☐ Allow material definitions "emissive" property to accept values > 1.0 for glowing materials (should be a real measurement like 'lumens' or something).
  ☐ Allow material definitions to specify emissive colors (not just grayscale intensity).
  ☐ pbr-direct-lighting doesnt include flood-filled block-light.
  ☐ pbr-direct-lighting doesnt include flood-filled sun-light.
  ☐ pbr-direct-lighting doesnt include shadow map.
  
New Features:
  PBR Material Definitions:
    ☐ Asset mapping rules should support specifying compound textures (overlay textures, etc) which use the canonical "++0~" combiner syntax. (eg. "game:block/clay/brick/four/soldier/cream1++0~game:block/clay/brick/four/soldier/black1")
      - Maybe we should just allow overlay assets to specify their material/normal/depth textures which are then combined with the base asset's textures when used as a composite texture?

LumOn → Lumen Alignment Work (Screen-Space Pipeline):

  Reference:
  - docs/LumOn.08-Pipeline-Alignment-with-Lumen.md (Section 6 target pipeline)

  Dependency order notes:
  - Pass 0 (HZB) modifies the tracer, so if we do it, do it before adding confidence + temporal/filter tuning.
  - Confidence must exist before: temporal-confidence blending, probe-space filtering, and cheaper gather projections.
  - Probe-space filtering must exist before any gather path that assumes "stable" probe radiance.

  Target pipeline:
    0. (New) Depth pyramid / HZB (optional, recommended)
    1. Probe Anchor (with jitter)
    2. Screen-Probe Atlas Trace (radiance + hitdist + meta)
    3. Screen-Probe Atlas Temporal (expanded to use meta)
    3.5 (New) Probe-space filter/denoise (edge-stopped)
    4. Gather (cheaper)
    5. Upsample (optional spatial denoise)
    6. Combine (optional)

✔ Phase 7 - Pass 1 - Probe Anchor Jitter: @done(26-01-17 09:06)
  Exit artifacts: Probe anchor pass supports jitter (frameIndex plumbing + optional config toggles); probe anchors remain MRT posWS/normalWS.

✔ Phase 8 - Pass 0 (Optional/Recommended) - Depth Pyramid / HZB: @done(26-01-17 09:06)
  Exit artifacts: Depth pyramid textures exist per frame; screen-probe tracer can consume HZB for traversal/refinement.

✔ Phase 9.0 - Naming/Refactor - Screen-Probe Atlas Terminology: @done(26-01-17 09:05)
  Exit artifacts: Public-facing names and file/class identifiers use “ScreenProbeAtlas” (or similar) instead of “Octahedral”, while octahedral remains an implementation detail for the mapping math.

✔ Phase 9 - Pass 2 - Screen-Probe Atlas Meta Output: @done(26-01-17 09:05)
  Exit artifacts: Screen-probe trace outputs radiance/hitdist plus meta (confidence + bitflags); history preservation applies to meta too.

✔ Phase 10 - Pass 3 - Screen-Probe Atlas Temporal Uses Meta: @done(26-01-17 09:05)
  Exit artifacts: Screen-probe atlas temporal produces meta-aware stabilized atlases suitable for downstream filtering/gather.

✔ Phase 11 - Pass 3.5 - Probe-Space Filter/Denoise (New): @done(26-01-17 09:03)
  Exit artifacts: Filtered atlas exists (radiance/hitdist/confidence as applicable); renderer can choose raw vs filtered as gather input.

✔ Phase 12 - Pass 4 - Cheaper Gather Options: @done(26-01-17 09:03)
  Exit artifacts: Gather has a defined “cheap” mode (stride/fewer dirs) and/or a projected-basis path (if implemented) selectable via config.

✔ Phase 13 - Integration, Debug, and Performance: @done(26-01-17 09:03)
  Exit artifacts: New passes are debuggable and timed; perf baselines documented; optional minimal visual regression hooks exist.

☐ Phase 14 - Screen-Space Parity/Polish (Remaining Discrepancies):
  Depends on: Phase 9 (confidence), Phase 10 (temporal uses confidence), Phase 11 (probe-space filter).
  Exit artifacts: Screen-space GI is more Lumen-like in stability/robustness (exposure-stable, fewer edge holes, fewer temporal fireflies), with tests/diagnostics.
  ☐ Reprojection inputs (motion vectors / camera motion):
    - Determine whether VS exposes motion vectors or equivalent per-pixel velocity
    - If available: incorporate into temporal rejection/weighting for gather/upsample (and/or probe updates)
    - If not available: implement a best-effort camera-motion heuristic path (rotation/translation gating)
  ☐ Exposure / color space consistency:
    - Verify whether CapturedSceneTex is pre- or post-tonemap (and whether exposure changes frame-to-frame)
        Verified: it is pre-tonemap.
    - Add a debug view to compare captured scene vs expected linear lighting space
  ☐ Variance / moments for temporal stability:
    - Add optional moments buffer (e.g., first/second moment of radiance) for the probe atlas or for indirectHalf
    - Use it for variance clamp/firefly suppression in temporal and/or post-filter
  ☐ Screen-trace hole filling strategy:
    ✔ Add a controlled neighborhood resolve for rays that exit screen / miss due to disocclusion @done
    ✔ Use confidence to avoid smearing across depth/normal edges @done
    ✔ Ensure this is a bounded fallback (never overrides high-confidence hits) @done
  ☐ Sky visibility / sky-occlusion term (screen-space approximation):
    - Add an optional, cheap sky-visibility estimate (screen-space only) to reduce overly bright indoor skylight
    - Keep it explicitly marked as screen-space approximation (no world proxy)
  ☐ Add GPU functional tests:
    - ExposureChange_DoesNotCauseTemporalPumping (or a reduced equivalent)
    - VarianceClamp_ReducesFireflies_PreservesMean
    ✔ HoleFill_OnlyAffectsLowConfidenceAreas @done
    - SkyVisibility_ReducesIndoorSkylightWithoutBlackening

✔ Phase 15 - BRDF + AO + Short-Range AO Compositing (New): @done(26-01-17 09:03)
  Goal: Replace the current “simple add” indirect integration with a physically-plausible compositing pass that
  accounts for roughness/metallic/specular response and supports AO + short-range AO for better contact and sky occlusion.

  Exit artifacts: A dedicated composite stage exists (shader + program + renderer wiring) that:
    - Computes indirect diffuse/specular using a BRDF approximation (energy-conserving) from G-buffer material inputs
    - Applies AO and (optionally) short-range AO visibility for ambient/sky contribution
    - Produces stable, debuggable outputs with tests for correctness and edge cases

✔ Phase 16 - PBR Direct Lighting Pass System (New): @done(26-01-17 09:03)
  Goal: Create a dedicated, high-quality PBR direct-lighting pass that is independent of LumOn
  (LumOn remains indirect lighting and can be disabled), but produces the “direct” lighting inputs
  that LumOn consumes downstream for final compositing.

  This pass system will supersede the existing pbr-overlay approach.

  Exit artifacts: A direct-lighting pipeline exists that:
    - Produces a stable, linear-space direct lighting buffer (pre-tonemap) suitable for downstream GI
    - Uses physically-based lighting consistent with the BRDF assumptions in Phase 15
    - Can be run with LumOn disabled (direct lighting still correct)
    - Has clear attachment points for LumOn (capture sceneDirect, optional material buffers)
    - Replaces pbr-overlay in both runtime behavior and debug tooling

☐ Phase 17 - Short-Range AO Signal Generation (New):
  Goal: Produce a stable, deterministic short-range AO (or equivalent visibility direction) signal
  that can be fed into Phase 15 compositing, so short-range AO shading is based on real scene occlusion
  rather than a placeholder heuristic.

  Exit artifacts: A short-range AO signal exists per-pixel (and/or per-probe) with:
    - Clear definition of coordinate space (WS vs VS) and encoding
    - Stable output across frames (temporal stabilization as needed)
    - Plumbed into the Phase 15 composite split
    - Debug visualization modes and GPU functional tests

  Work items:
  ☐ Decide short-range AO source + representation:
    - Option A (screen-space): per-pixel short-range AO direction from multi-direction screen-space visibility
      - Sample a small set of directions around the shading normal
      - Accumulate unoccluded directions weighted by cosine/solid-angle to produce short-range AO direction
    - Option B (probe-derived): per-probe short-range AO direction from Screen-Probe Atlas meta/hit distances
      - Estimate dominant visibility direction per probe, then gather/interpolate to pixels
    - Representation:
      - Store short-range AO direction as unit vector (octahedral encoding recommended) + optional cone angle
      - Define fallback behavior when confidence is low (use geometric normal)

  ☐ Add buffer(s) in LumOnBufferManager:
    - Allocate short-range AO target(s):
      - Full-res: ShortRangeAoTex (RGBA16F or RG16F oct-encoded)
      - Optional half-res variant if generated alongside indirectHalf
    - If temporal: ShortRangeAoHistoryTex + meta to stabilize across frames

  ☐ Add new shader pass (or extend an existing pass) to generate short-range AO:
    - New shader pair suggestion: lumon_short_range_ao.vsh / lumon_short_range_ao.fsh
    - Inputs:
      - primaryDepth, gBufferNormal
      - (optional) ScreenProbeAtlas radiance/hitdist/meta and/or indirectHalf alpha weight
    - Outputs:
      - shortRangeAo (encoded)
      - (optional) shortRangeAoConeAngle or confidence

  ☐ Temporal stabilization (if needed):
    - Reproject previous short-range AO using existing matrices
    - Reject history on depth/normal mismatch (reuse thresholds)
    - Clamp/normalize to keep unit length

  ☐ Composite plumbing:
    - Bind short-range AO texture into Phase 15 composite path
    - Replace placeholder “bend toward up” heuristic with sampled short-range AO direction
    - Ensure behavior is gated behind EnableShortRangeAo and falls back cleanly

  ☐ Debug modes + visualization:
    - ShortRangeAoDirection (RGB visualization in view/world space)
    - ShortRangeAoVsGeometricNormal (difference heatmap)
    - ShortRangeAoConfidence / ConeAngle visualization (if implemented)

  ☐ GPU functional tests:
    - ShortRangeAo_UnitLength_OrValidFallback
    - ShortRangeAo_OccluderBendsAwayFromBlockedDirections (minimal deterministic occluder)
    - ShortRangeAo_TemporalStableUnderStaticCamera
    - ShortRangeAo_RejectionOnDisocclusion

 ☐ Phase 18 - World-Space Clipmap Probe System - Implementation (New):
  Goal: Implement world-space clipmap probes per LumOn.16-21 with L1 SH, CPU async voxel traces,
  and ShortRangeAO visibility, feeding the Phase 15 composite alongside screen-space GI.

    Reference:
    - docs/LumOn.01-Core-Architecture.md (overall GI architecture + ownership boundaries)
    - docs/LumOn.02-Probe-Grid.md (probe sampling conventions that world probes should match)
    - docs/LumOn.16-World-Space-Clipmap-Probes.md (what/why + high-level system shape)
    - docs/LumOn.17-Clipmap-Topology-and-Addressing.md (origin snapping, rings, addressing)
    - docs/LumOn.18-Probe-Data-Layout-and-Packing.md (L1 SH packing, metadata, formats)
    - docs/LumOn.19-Update-Pipeline-and-Scheduling.md (CPU update selection, budgets, SSBO upload)
    - docs/LumOn.20-Streaming-and-Persistence.md (streaming, cache persistence, versioning)
    - docs/LumOn.21-Shading-Integration.md (shading path + blend policy with screen-space GI)
    - docs/Profiling.EventSource.md (timing + profiling hooks)

  Exit artifacts: A working world-probe pipeline that updates clipmaps over time, blends with
  screen-space GI using confidence, exposes debug views, and includes basic validation tests.

  Work items:
  ☐ Add config + defaults:
      - Add config values (ClipmapBaseSpacing, ClipmapResolution, ClipmapLevels, per-level budgets). (docs/LumOn.16, docs/LumOn.19)
    - Wire config load, hot-reload behavior, and safety bounds.

  ☐ Implement clipmap state + scheduling:
      - Origin snapping per level and ring-buffer addressing. (docs/LumOn.17)
      - Dirty region tracking and per-level update budgets. (docs/LumOn.19)
      - Probe selection policy (near-field, dirty regions, stale probes). (docs/LumOn.19)

  ☐ Implement CPU trace backend:
      - Iterative async voxel tracing for selected probes. (docs/LumOn.19)
      - Produce per-probe trace samples and metadata for GPU integration. (docs/LumOn.18, docs/LumOn.19)

  ☐ GPU upload + integration:
      - Define SSBO layout for trace headers and samples. (docs/LumOn.18, docs/LumOn.19)
      - Integrate trace samples into L1 SH + ShortRangeAO + confidence. (docs/LumOn.18)
      - Apply probe-space filtering and write clipmap textures. (docs/LumOn.19)

  ☐ Buffer and texture management:
      - Allocate per-level textures for SH, ShortRangeAO, confidence, and distance. (docs/LumOn.18)
      - Handle resize/recreate on config changes or resolution updates. (docs/LumOn.16, docs/LumOn.18)

    ☐ Streaming and persistence:
      - Cache warm-start / persistence as appropriate (optional). (docs/LumOn.20)
      - Versioning/invalidation on config changes and content changes. (docs/LumOn.20)

  ☐ Shading integration:
      - Sample world probes with trilinear + overlap blending. (docs/LumOn.21)
      - Blend with screen-space GI (screen-first, confidence-based). (docs/LumOn.21)
      - Feed Phase 15 composite inputs, including optional ShortRangeAO use. (docs/LumOn.21)

  ☐ Debug tooling:
      - Debug views for world probe irradiance, ShortRangeAO, confidence, and blend weights. (docs/LumOn.21)
      - GPU timing for update and filter passes. (docs/Profiling.EventSource.md)

  ☐ Tests:
    - Clipmap origin snapping determinism across camera paths.
    - Probe sampling stability across camera movement.
