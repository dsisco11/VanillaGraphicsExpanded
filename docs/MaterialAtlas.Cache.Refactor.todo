Material Atlas Disk Cache - Meta Index + Cache-Only Warmup:

  Goal:
  Replace per-tile .meta sidecars with a single meta.json index and add a cache-only warmup pass
  that enqueues cached tiles immediately during loading, deferring cache misses to the normal pipeline.

  References:
  - docs/MaterialSystem.Cache.Architecture.md
  - VanillaGraphicsExpanded/PBR/Materials/Cache/MaterialAtlasDiskCache.cs
  - VanillaGraphicsExpanded/PBR/Materials/Cache/IMaterialAtlasDiskCache.cs
  - VanillaGraphicsExpanded/PBR/Materials/MaterialAtlasSystem.cs
  - VanillaGraphicsExpanded/PBR/Materials/Async/MaterialAtlasBuildScheduler.cs
  - VanillaGraphicsExpanded/PBR/Materials/Async/MaterialAtlasParamsCpuCachedTileJob.cs
  - VanillaGraphicsExpanded/PBR/Materials/Async/MaterialAtlasNormalDepthCpuJob.cs

  Notes / Constraints:
  - No migration from legacy per-tile .meta files (new cache index only).
  - Warmup is cache-only: no procedural or bake work is scheduled in the warmup pass.
  - meta.json must be written atomically and remain resilient to partial writes or crashes.


  Phase 0 - Schema and Decisions:
  Exit artifacts: meta.json schema is documented and stable; field ownership and LRU rules are clear.
  ☐ Define meta.json top-level shape (version, entries, totalBytes, etc.).
  ☐ Define entry keying (file stem + kind) and required fields:
    - kind, schemaVersion, hash64
    - width, height, channels
    - createdUtcTicks, lastAccessUtcTicks
    - sizeBytes, ddsFileName (or derivable)
  ☐ Decide how LRU is updated (access ticks per read vs per upload).
  ☐ Document schema changes in docs/MaterialSystem.Cache.Architecture.md (remove .meta sidecars).


  Phase 1 - Cache Index Load/Save:
  Exit artifacts: MaterialAtlasDiskCache loads meta.json on init, validates entries, and saves updates atomically.
  ☐ Add in-memory index structure (dictionary + totals) inside MaterialAtlasDiskCache.
  ☐ Load meta.json at cache initialization; ignore if missing or invalid.
  ☐ Validate entries on load:
    - Drop entries with missing .dds payloads
    - Validate header dimensions and channel counts
  ☐ Implement atomic save (write temp, replace, best-effort on failure).
  ☐ Ensure thread-safety for concurrent read/write (lock or RW lock).


  Phase 2 - Refactor Cache Ops to Use Index:
  Exit artifacts: All reads/writes/prunes/stats operate on meta.json + index only.
  ☐ Remove per-file .meta read/write logic and file timestamp LRU.
  ☐ Update TryLoad* to consult index before reading .dds; update lastAccess on hit.
  ☐ Update Store* to add/update entries and totalBytes; persist index.
  ☐ Update TryPruneIfNeeded to use index LRU ordering; delete .dds and drop entries.
  ☐ Update GetStatsSnapshot to read from index totals (no directory walk).


  Phase 3 - Cache-Only Warmup Planning:
  Exit artifacts: A warmup plan can be built that schedules cached tiles without baking.
  ☐ Extend IMaterialAtlasDiskCache to support cheap index lookups:
    - TryGetEntry(key) or HasEntry(key)
  ☐ Build a cache-only plan:
    - For each material params tile: build cache key, check index, enqueue cached job on hit.
    - For override tiles: prefer override cache key; enqueue if present.
    - For normal/depth tiles and overrides: check cache keys and enqueue on hit.
  ☐ Create CPU job variants that only read cached .dds (no bake fallback).


  Phase 4 - Warmup Integration:
  Exit artifacts: Warmup runs during loading and does not trigger baking for misses.
  ☐ Add MaterialAtlasSystem warmup entry point (e.g., WarmupAtlasCache).
  ☐ Hook warmup into startup path (loading screen) before PopulateAtlasContents.
  ☐ Ensure warmup does not re-run for identical atlas stats.
  ☐ Ensure normal build still runs later to fill misses (cache hits can be skipped or re-used).
  ☐ Add logging/diagnostics for warmup hits/misses and warmup completion.


  Phase 5 - Tests and Docs:
  Exit artifacts: meta.json behavior and warmup scheduling are covered by tests and docs.
  ☐ Update MaterialAtlasDiskCacheRoundTripTests for meta.json read/write and LRU updates.
  ☐ Add tests for index validation (missing .dds, bad headers, invalid schema).
  ☐ Add tests for warmup planning (hits enqueue jobs, misses ignored).
  ☐ Update docs/MaterialSystem.Cache.Architecture.md to reflect meta.json and warmup pass.
