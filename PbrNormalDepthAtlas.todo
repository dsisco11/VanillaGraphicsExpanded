PBR Normal+Depth Sidecar Atlas (GPU Bake Plumbing):

  Goal:
  - Add a new sidecar atlas texture that is UV-aligned with the vanilla terrain albedo atlas pages.
  - The normal+depth atlas is handled the same way as the existing generated material params atlas:
    - One sidecar texture per base atlas page
    - Keyed by base atlas page GL texture id
    - Bound automatically when the engine binds that base atlas page
    - Sampled in chunk shaders using the same atlas UVs
  - Pixels are generated by a GPU shader that reads the base albedo atlas and derives depth, then normals.
  - The bake algorithm is intentionally unspecified in this scope; implement only the plumbing.

  Notes / Constraints:
  - Keep UV alignment exact: the sidecar must match atlas page dimensions 1:1.
  - Must be vanilla-safe:
    - If a shader is not patched to declare the uniform, binding must no-op (uniform location -1).
    - If the sidecar atlas is missing for a page, binding must no-op.
  - GL uploads / render-to-texture work must occur on the correct thread/context.
  - Reserve a dedicated texture unit for the new sampler; avoid collisions with the existing params atlas binding.

  Phase 1 - Spec + ABI Surface:
  Exit artifacts: Uniform/include/function names agreed; texture unit reserved; the feature can be toggled/disabled without breaking shaders.
  ✔ Choose naming (stable ABI):
    - Uniform sampler: vge_normalDepthTex
    - Include file: includes/vge_normaldepth.glsl
    - Shader helper: ReadNormalDepth(vec2 uv) -> vec4
  ✔ Choose a texture unit allocation:
    - Existing material params uses unit 15
    - Normal+depth uses unit 14
  ✔ Decide minimal format contract (no algorithm yet):
    - Provisional packing: vec4(normalXYZ_packed01, depth01)
    - Treat the texture as RGBA16F for plumbing (allows future packing changes)
    - Shader-side helper owns the decode contract so callers don't depend on packing

  Phase 2 - Atlas Ownership: Extend Existing Owner to Hold Two Sidecars:
  Exit artifacts: PbrMaterialAtlasTextures owns a per-page bundle with both params and normal+depth textures.
  ✔ Refactor per-page dictionary value in PbrMaterialAtlasTextures:
    - Replace Dictionary<int, DynamicTexture> with Dictionary<int, PageTextures>
    - PageTextures contains:
      - MaterialParamsTex (existing)
      - NormalDepthTex (new)
  ✔ Ensure rebuild is atomic:
    - Rebuild() disposes old textures then rebuilds both sidecars per page
  ✔ Ensure Dispose() releases both textures and clears dictionaries

  Phase 3 - Normal+Depth Bake Plumbing (Stubbed GPU Builder):
  Exit artifacts: A callable GPU bake path exists, but can return placeholder output until algorithm is implemented.
  ✔ Add a new builder entrypoint (GPU) that is invoked per atlas page:
    - Inputs:
      - baseAlbedoAtlasPageTexId (GL id)
      - destNormalDepthTexId (GL id)
      - atlas page dimensions
    - Output:
      - writes into destNormalDepthTexId
  ✔ Implement a temporary placeholder output (until algorithm exists):
    - Option A: write constant normal (0.5, 0.5, 1.0) + depth 0
    - Option B: copy albedo luminance into depth channel and set normal constant
  ✔ Wire builder into PbrMaterialAtlasTextures.Rebuild() for each atlas page

  Phase 4 - Shader Include + Injection:
  Exit artifacts: Chunk shaders compile with a new uniform + include, but behavior is unchanged unless used.
  ✔ Add include file: assets/.../shaders/includes/vge_normaldepth.glsl
    - Define ReadNormalDepth(uv) and any tiny helpers
    - Keep it stable and minimal
  ✔ Extend shader patcher to inject:
    - `@import "./includes/vge_normaldepth.glsl"` for chunk shaders
    - `uniform sampler2D vge_normalDepthTex;` near existing VGE sampler injections
  ✔ Keep it safe for non-chunk shaders:
    - Only inject into relevant terrain chunk shader programs

  Phase 5 - Runtime Binding Hook (Mirror Existing Pattern):
  Exit artifacts: When the engine binds a base terrain atlas page, the matching normal+depth sidecar page is bound too.
  ✔ Extend the existing binding hook (TerrainMaterialParamsTextureBindingHook):
    - Patch the same shader setter(s) (TerrainTex2D, TerrainTex2DLinear, etc.)
    - Look up sidecar textures by base page GL id
  ✔ Bind to the reserved texture unit and set the `vge_normalDepthTex` uniform
  ✔ Cache uniform locations per shader program id, clear cache on ReloadShader
  ✔ Validate no-op behavior:
    - Uniform missing -> do nothing
    - Sidecar missing -> do nothing

  Phase 6 - Integration Switches + Diagnostics:
  Exit artifacts: Feature can be enabled/disabled and debugged without guessing.
  ✔ Add a toggle (config or code-level) to enable/disable normal+depth baking/binding
  ✔ Add debug logging (guarded / optional):
    - Report when a shader lacks the uniform
    - Report atlas page counts and texture dimensions
  ✔ Add a simple debug visualization mode (optional):
    - Sample ReadNormalDepth and output to a debug render target (if you already have a debug view)

  Phase 7 - Tests + Validation:
  Exit artifacts: Plumbing regressions are caught (even without final bake algorithm).
  ☐ Unit-style tests (where feasible):
    - Page key mapping is consistent (base page id -> sidecar)
    - Uniform-location cache invalidation works on reload
  ☐ Runtime sanity checks:
    - No crashes when running without injected shader (uniform missing)
    - No GL errors when textures are absent/disabled
    - Atlas rebuild works across ReloadShader

  Phase 8 - Follow-up (Algorithm Definition):
  Exit artifacts: A separate scope for the actual depth-from-albedo and normals-from-depth algorithm.
  ☐ Decide/implement depth-from-albedo derivation (algorithm TBD)
  ☐ Implement normals-from-depth (sobel/finite differences + scale)
  ☐ Decide packing (normal XY vs XYZ, depth precision, channel assignments)
  ☐ Update ReadNormalDepth decode + any consumers accordingly
