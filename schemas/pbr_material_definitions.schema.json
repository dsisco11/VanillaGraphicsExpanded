{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.invalid/schemas/vge/pbr_material_definitions.schema.json",
  "title": "VGE PBR Material Definitions",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "defaults", "materials", "mapping"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Optional schema reference for editors."
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Schema version. Current: 1."
    },
    "notes": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Optional informational strings; ignored at runtime."
    },
    "defaults": { "$ref": "#/$defs/defaults" },
    "materials": {
      "type": "object",
      "description": "Map of material key -> material definition. Keys may be local (e.g. 'stone') or fully-qualified (e.g. 'mymod:stone').",
      "additionalProperties": { "$ref": "#/$defs/material" }
    },
    "mapping": {
      "type": "array",
      "description": "Ordered mapping rules from texture glob -> material id.",
      "items": { "$ref": "#/$defs/mappingRule" }
    }
  },
  "$defs": {
    "defaults": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "roughness": { "$ref": "#/$defs/unitFloat" },
        "metallic": { "$ref": "#/$defs/unitFloat" },
        "emissive": { "$ref": "#/$defs/unitFloat" },
        "noise": { "$ref": "#/$defs/noise" }
      }
    },
    "material": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "roughness": { "$ref": "#/$defs/unitFloat" },
        "metallic": { "$ref": "#/$defs/unitFloat" },
        "emissive": { "$ref": "#/$defs/unitFloat" },
        "noise": { "$ref": "#/$defs/noise" },
        "notes": { "type": "string" },
        "priority": { "$ref": "#/$defs/priority" }
      }
    },
    "noise": {
      "type": "object",
      "additionalProperties": false,
      "description": "Per-channel delta-range values used by shaders to apply deterministic Squirrel3 noise.",
      "properties": {
        "roughness": { "$ref": "#/$defs/unitFloat" },
        "metallic": { "$ref": "#/$defs/unitFloat" },
        "emissive": { "$ref": "#/$defs/unitFloat" },
        "reflectivity": { "$ref": "#/$defs/unitFloat" },
        "normals": { "$ref": "#/$defs/unitFloat" }
      }
    },
    "mappingRule": {
      "type": "object",
      "additionalProperties": false,
      "required": ["match", "values"],
      "properties": {
        "id": { "type": "string" },
        "description": { "type": "string" },
        "priority": { "$ref": "#/$defs/priority" },
        "match": { "$ref": "#/$defs/match" },
        "values": { "$ref": "#/$defs/mappingValues" }
      }
    },
    "match": {
      "type": "object",
      "additionalProperties": false,
      "required": ["glob"],
      "properties": {
        "glob": {
          "type": "string",
          "description": "Globstar pattern matched against canonical asset key 'assets/<domain>/<path>'.",
          "pattern": "^assets/"
        }
      }
    },
    "mappingValues": {
      "type": "object",
      "additionalProperties": false,
      "required": ["material"],
      "properties": {
        "material": {
          "type": "string",
          "minLength": 1,
          "description": "Material key or fully-qualified MaterialId."
        },
        "overrides": {
          "$ref": "#/$defs/mappingOverrides",
          "description": "Optional explicit texture overrides used to fill the PBR atlases (replaces procedural generation/bake when present)."
        }
      }
    },
    "mappingOverrides": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "materialParams": {
          "type": "string",
          "minLength": 1,
          "description": "Optional explicit material params map asset id (AssetLocation shorthand)."
        },
        "normalHeight": {
          "type": "string",
          "minLength": 1,
          "description": "Optional explicit packed normal+height map asset id (AssetLocation shorthand)."
        },
        "scale": {
          "$ref": "#/$defs/overrideScale",
          "description": "Optional per-rule override multipliers. Semantics: output = clamp01(input * scale). Missing/null values are treated as 1.0 (no-op)."
        }
      }
    },
    "overrideScale": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "roughness": { "$ref": "#/$defs/scaleFloatOrNull" },
        "metallic": { "$ref": "#/$defs/scaleFloatOrNull" },
        "emissive": { "$ref": "#/$defs/scaleFloatOrNull" },
        "normal": { "$ref": "#/$defs/scaleFloatOrNull" },
        "depth": { "$ref": "#/$defs/scaleFloatOrNull" }
      }
    },
    "unitFloat": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0
    },
    "scaleFloatOrNull": {
      "description": "Optional non-negative multiplier. Missing/null => 1.0 at runtime.",
      "type": ["number", "null"],
      "minimum": 0.0
    },
    "priority": {
      "type": "integer",
      "description": "Higher priority wins when resolving conflicts."
    }
  }
}
